# grant contributor role over the resource group to our service principal
https://learn.microsoft.com/en-us/cli/azure/role/assignment?view=azure-cli-latest#az-role-assignment-create
f7d0cfcb-65b9-4f1c-8c9d-f8f993e4722a

Create a new role assignment for a user, group, or service principal. (autogenerated)
az ad sp list --filter "displayname eq 'api://reports'" 
"appDisplayName": "api://reports",
"appId": "15cdd566-98bb-4130-8ec5-5c58cffb34bf",
"appOwnerOrganizationId": "b4b87e8f-df64-41ff-9ba4-a4930ebc804b",
"displayName": "api://reports",
"id": "cc991d02-41dc-422b-84c2-7abc97f304fe",

export SUBSCRIPTION="f7d0cfcb-65b9-4f1c-8c9d-f8f993e4722a"
export RESOURCEGROUP=reports
export SERVICE_PRINCIPAL_JSON=$(pass reports/SERVICE_PRINCIPAL_JSON)
export APP_ID=$(echo $SERVICE_PRINCIPAL_JSON | jq -r '.appId')
                                                                              /subscriptions/f7d0cfcb-65b9-4f1c-8c9d-f8f993e4722a/resourceGroups/reports
az role assignment create --assignee "$APP_ID" --role "Contributor" --scope "/subscriptions/$SUBSCRIPTION/resourceGroups/$RESOURCEGROUP"
The client 'bgroves@buschegroup.com' with object id 'a69026f5-9ff3-459a-a9e9-1ffb1bd43207' does not have authorization to perform action 'Microsoft.Authorization/roleAssignments/write' over scope '/subscriptions/f7d0cfcb-65b9-4f1c-8c9d-f8f993e4722a/resourceGroups/reports/providers/Microsoft.Authorization/roleAssignments/60c3eeb3-fb1d-47f1-a935-e0db23180dab' or the scope is invalid. If access was recently granted, please refresh your credentials.

az role assignment create --assignee 00000000-0000-0000-0000-000000000000 --role "Storage Account Key Operator Service Role" --scope $id

az role assignment create --assignee $SERVICE_PRINCIPAL \
--scope "/subscriptions/$SUBSCRIPTION/resourceGroups/$RESOURCEGROUP" \
--role Contributor

{
  "canDelegate": null,
  "id": "/subscriptions/c9170272-6419-45d7-a3d5-9526a65e8e91/resourceGroups/reports-aks/providers/Microsoft.Authorization/roleAssignments/4640090d-719b-455f-b63e-11bab865ac11",
  "name": "4640090d-719b-455f-b63e-11bab865ac11",
  "principalId": "da29e589-8bc3-45ff-8b8e-f8ab2206a603",
  "principalType": "ServicePrincipal",
  "resourceGroup": "reports-aks",
  "roleDefinitionId": "/subscriptions/c9170272-6419-45d7-a3d5-9526a65e8e91/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c",
  "scope": "/subscriptions/c9170272-6419-45d7-a3d5-9526a65e8e91/resourceGroups/reports-aks",
  "type": "Microsoft.Authorization/roleAssignments"
}
